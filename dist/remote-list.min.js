!function(a,b,c){function d(b,c){e++,this.element=a(b),this.options=a.extend({},d.defaults,c),this.cache={},this.id="remotelist-"+e,this.options.param||(this.options.param=this.element.prop("name")||"q"),this._selectedOptionCache={val:"",elem:null},this._createDatalist(),this._bindEvents(this)}var e=0;d.defaults={minLength:2,maxLength:-1,source:"",param:"",select:a.noop,renderItem:null},d.createOption=function(b){var c=document.createElement("option");return b&&"string"!=typeof b||(b={value:b}),a.prop(c,"value",b.value),b.label&&a.prop(c,"label",b.label),a.data(c,"optionData",b),c},d.prototype={selectedData:function(){var b=this.selectedOption();return b&&a.data(b,"optionData")},selectedOption:function(){var b=null,c=this.element.val();return this._selectedOptionCache.val==c?b=this._selectedOptionCache.elem:(this.element.jProp("list").jProp("options").each(function(){return c==a.prop(this,"value")?(b=this,!1):void 0}),this._selectedOptionCache.elem=b,this._selectedOptionCache.val=c),b},search:function(b){var c,d,e,f=this,g=this.options,h=b;g.maxLength>-1&&(h=h.substr(g,g.maxLength)),this.doAjax=!1,this.cache[h]?this.setList(this.cache[h],h):this.currentAjax?this.doAjax=b:(this.element.addClass("list-search"),c={},c[g.param]=b,this.currentAjax=!0,reset=function(){reset.xhr&&reset.xhr.abort&&reset.xhr.abort(),f.currentAjax=!1,clearTimeout(reset.timer),f.doAjax?f.search(f.doAjax):f.element.removeClass("list-search")},d=a.isFunction(g.source)?g.source:function(b,c,d,e,f){return a.ajax({dataType:"json",url:f,data:e,context:this,error:d,success:c})},e=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){}f.setList(a,h),reset()},reset.timer=setTimeout(reset,999),reset.xhr=d(b,e,reset,c,g.source))},setList:function(b,c){b||(b=[]),this.currentOptions!=b&&this.currentVal!==c&&(this.currentOptions=b,this.currentVal=c,this._selectedOptionCache.val="",this._selectedOptionCache.elem=null,this.cache[c]=b,b=a.map(b,d.createOption),this.datalistSelect.html(b),a.fn.updatePolyfill&&this.datalistSelect.updatePolyfill())},_createDatalist:function(){this.datalistSelect=this.element.prop("list"),this.datalistSelect||(this.datalistSelect=a(a.parseHTML('<datalist id="'+this.id+'"><select /></datalist>')),this.element.attr("list",this.id),this.element.after(this.datalistSelect)),this.datalistSelect=a("select",this.datalistSelect)},val:function(){return b&&b.getDataListVal?b.getDataListVal(this.element[0]):this.element.prop("value")},_bindEvents:function(b){var c,d,e,f=b.options,g=function(){var d;return function(g){var h=b.val();if(h!==d&&(d=h,"change"==g||!e||e.toLowerCase()!=h.charAt(h.length-1).toLowerCase()))return b.selectedOption()?(clearTimeout(c),f.select&&f.select.call(b.element[0],a.Event("listselect")),b.element.trigger("listselect"),!0):void 0}}();b.element.on({"input focus":function(){var a=function(){var a=b.val();a.length>=f.minLength&&b.search(a)};return function(){clearTimeout(c),c=setTimeout(a,99)}}(),"input change":function(a){clearTimeout(d),"change"==a.type?(clearTimeout(c),b.element.is(":focus")&&g("change")):d=setTimeout(g,9)},keypress:function(){var a=function(){e=""};return function(b){e=String.fromCharCode(b.charCode),setTimeout(a,20)}}(),getoptioncontent:function(b,c){return f.renderItem?f.renderItem('<span class="option-value">'+c.item.value+"</span>",c.item.label&&'<span class="option-label">'+c.item.label+"</span>",a.data(c.item.elem,"optionData")):void 0}})}},a.fn.remoteList=function(b,e){var f=b,g=this;return this.each(function(){var h,i,j=a(this).data("remoteList");if("string"==typeof j&&(i={source:j},j=!1),j&&a.isPlainObject(j)&&(i=j,j=!1),j&&j[f]){if(h=j[f].apply?j[f].apply(j,e):j[f],h!==c)return g=h,!1}else a.data(this,"remoteList",new d(this,a.extend({},b,i)))}),g},a.fn.remoteList.constructorFn=d}(window.webshims&&webshims.$||jQuery,window.webshims);